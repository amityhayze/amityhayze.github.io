<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amity Hayze â€” CRT Visualizer Room</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<style>
  :root {
    --neon: #00f0ff;
    --hazy-pink: rgba(255,107,205,0.35);
    --bg-dark: #000;
    --panel: rgba(0,0,0,0.7);
  }
  html, body { margin:0; padding:0; height:100%; font-family:monospace; background:var(--bg-dark); color:var(--neon); overflow:hidden;}
  body { display:flex; justify-content:center; align-items:center; flex-direction:column; }
  canvas { display:block; margin:0 auto; background:#000; border:2px solid var(--neon); border-radius:8px; }
  #tv-container { position:relative; width:800px; max-width:90vw; height:450px; margin-bottom:20px; }
  #overlay { position:absolute; inset:0; pointer-events:none; }
  .controls { display:flex; justify-content:center; gap:12px; margin-top:12px; flex-wrap:wrap; }
  .controls label { color:var(--neon); font-size:14px; }
  .controls input[type=range] { width:120px; }
  .menu { position:absolute; top:0; left:0; width:100%; height:100%; display:flex; justify-content:center; align-items:center; background:rgba(0,0,0,0.85); color:var(--neon); font-size:18px; flex-direction:column; gap:16px; }
  .menu.hidden { display:none; }
  .btn { padding:8px 14px; border-radius:6px; border:1px solid var(--neon); background:rgba(0,0,0,0.2); color:var(--neon); cursor:pointer; text-transform:uppercase; font-weight:700; }
</style>
</head>
<body>

<h1 style="color:var(--hazy-pink); text-align:center;">CRT Visualizer Room</h1>

<div id="tv-container">
  <canvas id="screen"></canvas>
  <canvas id="overlay"></canvas>

  <div class="menu" id="tv-menu">
    <div>Welcome to the TV Visualizer Room</div>
    <button class="btn" id="open-visualizer">Open Visualizer</button>
    <button class="btn" id="open-games">Mini Games</button>
    <button class="btn" id="open-effects">Effects Playground</button>
  </div>
</div>

<div class="controls">
  <label>Color Shift <input type="range" min="0" max="360" value="0" id="colorShift"></label>
  <label>Glitch Intensity <input type="range" min="0" max="20" value="5" id="glitchIntensity"></label>
  <label>Pulse Speed <input type="range" min="0.1" max="5" step="0.1" value="1" id="pulseSpeed"></label>
</div>

<audio id="track" src="Cascade Canyon.mp3" loop></audio>

<script>
const screen = document.getElementById('screen');
const overlay = document.getElementById('overlay');
const menu = document.getElementById('tv-menu');
const track = document.getElementById('track');
const ctx = screen.getContext('2d');
const octx = overlay.getContext('2d');

let colorShift = 0;
let glitchIntensity = 5;
let pulseSpeed = 1;

const knobs = {
  colorShift: document.getElementById('colorShift'),
  glitchIntensity: document.getElementById('glitchIntensity'),
  pulseSpeed: document.getElementById('pulseSpeed')
};

// Resize canvas
function resizeCanvas() {
  screen.width = screen.clientWidth;
  screen.height = screen.clientHeight;
  overlay.width = overlay.clientWidth;
  overlay.height = overlay.clientHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Audio visualizer setup
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const analyser = audioCtx.createAnalyser();
analyser.fftSize = 256;
const source = audioCtx.createMediaElementSource(track);
source.connect(analyser);
analyser.connect(audioCtx.destination);
const bufferLength = analyser.frequencyBinCount;
const dataArray = new Uint8Array(bufferLength);

// Controls events
knobs.colorShift.addEventListener('input', e => colorShift = parseInt(e.target.value));
knobs.glitchIntensity.addEventListener('input', e => glitchIntensity = parseInt(e.target.value));
knobs.pulseSpeed.addEventListener('input', e => pulseSpeed = parseFloat(e.target.value));

// Menu buttons
document.getElementById('open-visualizer').addEventListener('click', ()=>menu.classList.add('hidden'));
document.getElementById('open-games').addEventListener('click', ()=>alert('Mini-games coming soon!'));
document.getElementById('open-effects').addEventListener('click', ()=>alert('Effects playground coming soon!'));

// Draw loop
function draw() {
  ctx.clearRect(0,0,screen.width,screen.height);
  analyser.getByteFrequencyData(dataArray);

  const barWidth = screen.width / bufferLength;
  for(let i = 0; i < bufferLength; i++){
    const barHeight = dataArray[i];
    const hue = (i*4 + colorShift) % 360;
    ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
    ctx.fillRect(i*barWidth, screen.height - barHeight, barWidth, barHeight);
  }

  // CRT overlay flicker
  octx.clearRect(0,0,overlay.width,overlay.height);
  const lines = 100;
  for(let i=0;i<lines;i++){
    octx.fillStyle = `rgba(255,255,255,${Math.random()*0.03})`;
    octx.fillRect(0, i*(overlay.height/lines), overlay.width, 1);
  }
  // subtle glitch pulses
  octx.fillStyle = `rgba(255,0,255,0.05)`;
  for(let i=0;i<glitchIntensity;i++){
    const x = Math.random()*overlay.width;
    const y = Math.random()*overlay.height;
    const w = Math.random()*10;
    const h = Math.random()*5;
    octx.fillRect(x,y,w,h);
  }

  requestAnimationFrame(draw);
}

// Start audio on first interaction
document.body.addEventListener('click', ()=>{
  if(audioCtx.state === 'suspended') audioCtx.resume();
  track.play();
});

draw();
</script>
</body>
</html>

