<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRT Visualizer Room</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<style>
  :root {
    --neon: #00f0ff;
    --hazy-pink: rgba(255,107,205,0.25);
    --bg-dark: #000;
    --panel: rgba(0,0,0,0.75);
  }
  *{box-sizing:border-box;}
  body {
    margin:0;
    font-family:"Courier New", monospace;
    background:#000;
    color:var(--neon);
    overflow:hidden;
  }
  body::before {
    content:"";
    position:fixed; inset:0;
    background:url('https://media.giphy.com/media/oEI9uBYSzLpBK/giphy.gif') center/cover no-repeat;
    opacity:0.12;
    z-index:-2;
    mix-blend-mode:screen;
    filter:grayscale(30%) contrast(1.05);
  }
  body::after {
    content:"";
    position:fixed; inset:0;
    background:radial-gradient(ellipse at center, rgba(0,0,0,0) 0%, rgba(0,0,0,0.55) 70%);
    z-index:-1;
  }

  /* TV Panel */
  #tv-panel {
    position:absolute;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    width:800px; max-width:90vw;
    background:var(--panel);
    border:2px solid var(--neon);
    border-radius:12px;
    box-shadow:0 0 20px var(--neon);
    padding:20px;
    display:flex; flex-direction:column; align-items:center;
  }

  h1 {margin:0; font-size:28px; text-shadow:0 0 8px var(--neon);}
  .tv-menu {
    margin-top:10px;
    display:flex; gap:12px;
  }
  .tv-menu button {
    padding:10px 16px;
    background:rgba(0,255,255,0.05);
    border:1px solid var(--neon);
    color:var(--neon);
    border-radius:6px;
    cursor:pointer;
    text-transform:uppercase;
  }
  .tv-menu button:hover { box-shadow:0 0 12px var(--neon); }

  /* Panels inside TV */
  .tv-content { margin-top:16px; width:100%; min-height:400px; position:relative; background:rgba(0,0,0,0.15); border-radius:10px; overflow:hidden; }
  .hidden { display:none; }

  /* Knobs */
  .knobs { display:flex; gap:12px; justify-content:center; margin:10px 0; }
  .knob-container { display:flex; flex-direction:column; align-items:center; }
  .knob-label { font-size:12px; margin-bottom:4px; }
  input[type=range]{-webkit-appearance:none;width:100px; background:transparent;}
  input[type=range]::-webkit-slider-thumb { -webkit-appearance:none; height:18px; width:18px; border-radius:50%; background:var(--neon); cursor:pointer; box-shadow:0 0 6px var(--neon);}
  input[type=range]::-webkit-slider-runnable-track { height:4px; background:rgba(0,255,255,0.15); border-radius:2px;}

  /* Mini Game canvas */
  canvas { width:100%; height:100%; display:block; background:transparent; }

  /* Neon pulses for visualizer */
  .pulse-circle {
    position:absolute; border-radius:50%; pointer-events:none;
    mix-blend-mode:screen; opacity:0.5;
    box-shadow:0 0 20px var(--neon);
  }
</style>
</head>
<body>

<div id="tv-panel">
  <h1>CRT Visualizer Room</h1>
  <div class="tv-menu">
    <button data-panel="visualizer">Audio Visualizer</button>
    <button data-panel="effects">Effects Playground</button>
    <button data-panel="games">Mini Games</button>
  </div>

  <div class="tv-content">
    <!-- Visualizer Panel -->
    <div id="visualizer-panel" class="panel">
      <audio id="track" src="Cascade Canyon.mp3" controls autoplay loop></audio>
      <canvas id="vizCanvas"></canvas>
    </div>

    <!-- Effects Playground -->
    <div id="effects-panel" class="panel hidden">
      <div class="knobs">
        <div class="knob-container">
          <div class="knob-label">Color Shift</div>
          <input type="range" min="0" max="360" value="0" id="colorKnob">
        </div>
        <div class="knob-container">
          <div class="knob-label">Glitch Intensity</div>
          <input type="range" min="0" max="20" value="0" id="glitchKnob">
        </div>
        <div class="knob-container">
          <div class="knob-label">Pulse Speed</div>
          <input type="range" min="0" max="5" step="0.1" value="1" id="pulseKnob">
        </div>
      </div>
      <canvas id="effectsCanvas"></canvas>
    </div>

    <!-- Mini Games Panel -->
    <div id="games-panel" class="panel hidden">
      <canvas id="gameCanvas"></canvas>
    </div>
  </div>
</div>

<script>
  // Panel switching
  document.querySelectorAll('.tv-menu button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.panel').forEach(p=>p.classList.add('hidden'));
      const panel = btn.dataset.panel+'-panel';
      document.getElementById(panel).classList.remove('hidden');
    });
  });

  /* Audio Visualizer */
  const track = document.getElementById('track');
  const vizCanvas = document.getElementById('vizCanvas');
  const vCtx = vizCanvas.getContext('2d');
  vizCanvas.width = vizCanvas.clientWidth;
  vizCanvas.height = vizCanvas.clientHeight;

  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const source = audioCtx.createMediaElementSource(track);
  const analyser = audioCtx.createAnalyser();
  source.connect(analyser);
  analyser.connect(audioCtx.destination);
  analyser.fftSize = 256;
  const bufferLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);

  function drawViz() {
    requestAnimationFrame(drawViz);
    analyser.getByteFrequencyData(dataArray);
    vCtx.clearRect(0,0,vizCanvas.width,vizCanvas.height);
    const barWidth = (vizCanvas.width / bufferLength) * 2.5;
    let x = 0;
    for(let i=0;i<bufferLength;i++){
      const barHeight = dataArray[i];
      vCtx.fillStyle = `hsl(${i*3},100%,50%)`;
      vCtx.fillRect(x,vizCanvas.height-barHeight/2,barWidth,barHeight/2);
      x += barWidth +1;
    }
  }
  drawViz();

  /* Effects Playground */
  const effectsCanvas = document.getElementById('effectsCanvas');
  const eCtx = effectsCanvas.getContext('2d');
  effectsCanvas.width = effectsCanvas.clientWidth;
  effectsCanvas.height = effectsCanvas.clientHeight;
  const colorKnob = document.getElementById('colorKnob');
  const glitchKnob = document.getElementById('glitchKnob');
  const pulseKnob = document.getElementById('pulseKnob');

  function drawEffects(){
    requestAnimationFrame(drawEffects);
    eCtx.clearRect(0,0,effectsCanvas.width,effectsCanvas.height);
    // pulsing circles
    for(let i=0;i<5;i++){
      const radius = 30+Math.sin(Date.now()/500*pulseKnob.value+i)*40;
      eCtx.beginPath();
      eCtx.arc(effectsCanvas.width/2+Math.sin(i)*50,effectsCanvas.height/2+Math.cos(i)*50,radius,0,Math.PI*2);
      eCtx.strokeStyle=`hsl(${colorKnob.value},100%,50%)`;
      eCtx.lineWidth=2+glitchKnob.value/2;
      eCtx.stroke();
    }
  }
  drawEffects();

  /* Mini Games - Neon Pong example */
  const gameCanvas = document.getElementById('gameCanvas');
  const gCtx = gameCanvas.getContext('2d');
  gameCanvas.width = gameCanvas.clientWidth;
  gameCanvas.height = gameCanvas.clientHeight;

  const paddleHeight = 80;
  const paddleWidth = 12;
  let playerY = (gameCanvas.height-paddleHeight)/2;
  let ballX = gameCanvas.width/2, ballY = gameCanvas.height/2;
  let ballSpeedX = 3, ballSpeedY=2;
  function drawGame(){
    requestAnimationFrame(drawGame);
    gCtx.clearRect(0,0,gameCanvas.width,gameCanvas.height);
    // paddles
    gCtx.fillStyle = 'lime';
    gCtx.fillRect(20,playerY,paddleWidth,paddleHeight);
    gCtx.fillRect(gameCanvas.width-32,playerY,paddleWidth,paddleHeight);
    // ball
    gCtx.beginPath();
    gCtx.arc(ballX,ballY,8,0,Math.PI*2);
    gCtx.fillStyle='cyan';
    gCtx.fill();
    // move
    ballX += ballSpeedX; ballY += ballSpeedY;
    if(ballY<=0 || ballY>=gameCanvas.height) ballSpeedY*=-1;
    if(ballX<=32 && ballY>playerY && ballY<playerY+paddleHeight) ballSpeedX*=-1;
    if(ballX>=gameCanvas.width-32 && ballY>playerY && ballY<playerY+paddleHeight) ballSpeedX*=-1;
    if(ballX<0 || ballX>gameCanvas.width) { ballX=gameCanvas.width/2; ballY=gameCanvas.height/2;}
  }
  drawGame();

  // player controls
  window.addEventListener('mousemove', e=>{
    const rect = gameCanvas.getBoundingClientRect();
    playerY = e.clientY-rect.top-paddleHeight/2;
    if(playerY<0) playerY=0;
    if(playerY>gameCanvas.height-paddleHeight) playerY=gameCanvas.height-paddleHeight;
  });

  // CRT flicker + background drift
  let flickerAlpha = 0.12;
  setInterval(()=>{flickerAlpha = 0.1+Math.random()*0.05; document.body.style.setProperty('--flicker',flickerAlpha)},50);
</script>

</body>
</html>
