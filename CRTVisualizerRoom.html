<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRT Visualizer Room</title>
<style>
  body {
    margin:0; background:#000; display:flex; flex-direction:column; align-items:center; font-family: monospace; color:#ff6bcd;
  }
  #tv-container {
    position: relative;
    width: 800px;
    height: 450px;
    border: 6px solid #ff6bcd;
    border-radius: 12px;
    margin-top: 40px;
    overflow: hidden;
    box-shadow: 0 0 64px rgba(255,107,205,0.6);
  }
  canvas {
    width: 100%; height: 100%; display: block;
  }
  #controls {
    margin-top: 16px;
    display: flex; gap: 16px; justify-content: center;
  }
  .knob-container {
    display:flex; flex-direction:column; align-items:center; font-size:14px;
  }
  input[type="range"] {
    width:120px;
    margin-top:4px;
  }
  #menu {
    position: absolute; top:10px; right:10px;
    background: rgba(0,0,0,0.7); padding:8px 12px; border-radius:8px; cursor:pointer;
    z-index: 10;
  }
  #menu-items { display:none; flex-direction:column; margin-top:4px; }
  #menu-items button { margin-top:4px; padding:4px 8px; border-radius:6px; background:rgba(255,255,255,0.1); border:none; color:#ff6bcd; cursor:pointer; }
</style>
</head>
<body>

<h1>CRT Visualizer Room</h1>

<div id="tv-container">
  <canvas id="screen"></canvas>
  <div id="menu">
    Menu â–¾
    <div id="menu-items">
      <button>Mini Game 1</button>
      <button>Mini Game 2</button>
    </div>
  </div>
</div>

<div id="controls">
  <div class="knob-container">
    <label for="colorShift">Color Shift</label>
    <input type="range" id="colorShift" min="0" max="360" value="0">
  </div>
  <div class="knob-container">
    <label for="glitchIntensity">Glitch Intensity</label>
    <input type="range" id="glitchIntensity" min="0" max="100" value="20">
  </div>
  <div class="knob-container">
    <label for="pulseSpeed">Pulse Speed</label>
    <input type="range" id="pulseSpeed" min="1" max="20" value="8">
  </div>
</div>

<audio id="track" src="Cascade Canyon.mp3" controls autoplay loop style="margin-top:16px; width:80%;"></audio>

<script>
const canvas = document.getElementById('screen');
const ctx = canvas.getContext('2d');
canvas.width = canvas.offsetWidth;
canvas.height = canvas.offsetHeight;

// Audio setup
const audio = document.getElementById('track');
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const source = audioCtx.createMediaElementSource(audio);
const analyser = audioCtx.createAnalyser();
analyser.fftSize = 512;
const bufferLength = analyser.frequencyBinCount;
const dataArray = new Uint8Array(bufferLength);
source.connect(analyser);
analyser.connect(audioCtx.destination);

let colorShift = 0, glitchIntensity = 20, pulseSpeed = 8;
document.getElementById('colorShift').addEventListener('input', e=>colorShift=parseInt(e.target.value));
document.getElementById('glitchIntensity').addEventListener('input', e=>glitchIntensity=parseInt(e.target.value));
document.getElementById('pulseSpeed').addEventListener('input', e=>pulseSpeed=parseInt(e.target.value));

// Draw visualizer
function draw() {
  ctx.fillStyle = 'rgba(0,0,0,0.15)'; // screen persistence
  ctx.fillRect(0,0,canvas.width,canvas.height);

  analyser.getByteFrequencyData(dataArray);
  const barWidth = canvas.width / bufferLength;

  for(let i=0;i<bufferLength;i++){
    const barHeight = dataArray[i]*1.8;
    const hue = (i*5 + colorShift) % 360;
    ctx.fillStyle = `hsl(${hue},100%,60%)`;
    ctx.fillRect(i*barWidth, canvas.height-barHeight, barWidth, barHeight);
  }

  // Glitch overlay
  for(let i=0;i<glitchIntensity;i++){
    ctx.fillStyle = `rgba(255,0,255,0.1)`;
    ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, Math.random()*15, Math.random()*8);
  }

  // Pulse / CRT flicker overlay
  const alpha = 0.08 + 0.05*Math.sin(Date.now()/100*pulseSpeed);
  ctx.fillStyle = `rgba(255,255,255,${alpha})`;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  requestAnimationFrame(draw);
}
draw();

// Menu toggle
const menu = document.getElementById('menu');
const menuItems = document.getElementById('menu-items');
menu.addEventListener('click', ()=> menuItems.style.display = menuItems.style.display==='flex'?'none':'flex');
</script>

</body>
</html>
